---
import type { MarkdownInstance } from "astro";
import type { Frontmatter } from "../../types/frontmatter.ts";
import { render } from "astro:content";
import { getEntry } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

import Blockquote from "../../components/mdx/Blockquote.astro";
import H1 from "../../components/mdx/H1.astro";
import H2 from "../../components/mdx/H2.astro";
import H3 from "../../components/mdx/H3.astro";
import H4 from "../../components/mdx/H4.astro";
import H5 from "../../components/mdx/H5.astro";
import H6 from "../../components/mdx/H6.astro";
import OrderedList from "../../components/mdx/OrderedList.astro";
import UnorderedList from "../../components/mdx/UnorderedList.astro";
import HorizontalRule from "../../components/mdx/HorizontalRule.astro";
import Table from "../../components/mdx/Table.astro";
import TableRow from "../../components/mdx/TableRow.astro";
import TableHeader from "../../components/mdx/TableHeader.astro";
import TableData from "../../components/mdx/TableData.astro";
import Anchor from "../../components/mdx/Anchor.astro";
import Image from "../../components/mdx/Image.astro";


export function getStaticPaths() {
    const allPosts = Object.values(import.meta.glob<MarkdownInstance<Frontmatter>>("../../content/posts/*.mdx", { eager: true }));

    return Array.from(allPosts).map((post) => ({
        params: { slug: post.frontmatter.title.toLowerCase().replace(/ /g, '-') },
    }));
}

const { slug } = Astro.params;
const post = await getEntry('posts', slug);

if (!post.data.published) {
    return Astro.redirect("/404");
} 

const { Content } = await render(post);
---

<BaseLayout>
    <div class="grid grid-col gap-5">
        <Content 
            components={{
                h1: H1,
                h2: H2,
                h3: H3,
                h4: H4,
                h5: H5,
                h6: H6,
                ol: OrderedList,
                ul: UnorderedList,
                hr: HorizontalRule,
                a: Anchor,
                table: Table,
                th: TableHeader,
                tr: TableRow,
                td: TableData,
                blockquote: Blockquote,
                img: Image,
            }}
        />
    </div>
</BaseLayout>